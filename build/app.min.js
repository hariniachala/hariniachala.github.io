angular.module("app",["ui.router"]),angular.module("app").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("app",{url:"/app",templateUrl:"app.html",cache:!1,controller:"AppController"}),t.otherwise("/app")}]),angular.module("app").constant("SPOTIFY_CLINET_ID","61f223f618424f60b1b6e451bff9806f").constant("SPOTIFY_CLINET_SECRET","b4dcb4a38c194e9cb6257dd5b0d9efc1").constant("SEARCH_FETCH_LIMIT",6),angular.module("app").service("cachingService",function(){function e(e){return localStorage[e]}function t(e,t){localStorage[e]=t}function r(){localStorage.clear()}return{getCache:e,setCache:t,clearCache:r}}),angular.module("app").service("spotifyService",["$http","$log","$q","cachingService","SEARCH_FETCH_LIMIT",function(e,t,r,a,n){function i(r,a){var i=n,s="https://api.spotify.com/v1/search?q="+encodeURIComponent(r)+"&type=artist,album&offset="+a+"&limit="+i;return e.get(s,{cache:!0}).then(function(e){return e&&t.debug("API GET was called. Response: "+JSON.stringify(e)),e.data})}function s(n,i){var s=r.defer(),c="artist-"+n,o=a.getCache(c);if(o)s.resolve(JSON.parse(o));else{var l="https://api.spotify.com/v1/artists/"+n+"/albums";e.get(l,{cache:!0}).then(function(e){e&&t.debug("API GET was called. Response: "+JSON.stringify(e));var r=e.data&&e.data.items?e.data.items:[];a.setCache(c,JSON.stringify(r)),s.resolve(r)})}return s.promise}function c(n,i){var s=r.defer(),c="album-"+n,o=a.getCache(c);if(o)s.resolve(JSON.parse(o));else{var l="https://api.spotify.com/v1/albums/"+n+"/tracks";e.get(l,{cache:!0}).then(function(e){e&&t.debug("API GET was called. Response: "+JSON.stringify(e));var r=e.data&&e.data.items?e.data.items:[];a.setCache(c,JSON.stringify(r)),s.resolve(r)})}return s.promise}return{searchArtistOrAlbum:i,getArtistAlbums:s,getAlbumTracks:c}}]),angular.module("app").directive("resizeHeight",["$window",function(e){return{restrict:"A",link:function(t,r){t.initResize=!1,t.initResize||(r.css("height",r[0].clientWidth+"px"),r.css("overflow","hidden"),t.initResize=!0),t.$watch(function(){return r[0].clientWidth},function(e,t){e!=t&&(r.css("height",r[0].clientWidth+"px"),r.css("overflow","hidden"))},!0);var a=angular.element(e);a.bind("resize",function(){t.$apply()})}}}]),angular.module("app").directive("modalBox",["$log","$q","spotifyService",function(e,t,r){return{restrict:"E",templateUrl:"directives/modal-box.html",scope:{selectedItem:"="},link:function(e,t){function a(){e.selectedItem&&"artist"===e.selectedItem.type&&r.getArtistAlbums(e.selectedItem.id,0).then(function(t){e.isLoaded=!0,e.selectedItem.list=t}),e.selectedItem&&"album"===e.selectedItem.type&&r.getAlbumTracks(e.selectedItem.id,0).then(function(t){e.isLoaded=!0,e.selectedItem.list=t})}e.$watch(function(){return null!=e.selectedItem},function(e,t){a()},!0)},controller:["$scope",function(e){function t(){return null!=e.selectedItem}function r(){e.selectedItem=null,e.isLoaded=!1}e.closeModal=r,e.showModal=t,e.isLoaded=!1}]}}]),angular.module("app").controller("AppController",["$scope","$log","$http","spotifyService","SEARCH_FETCH_LIMIT","cachingService",function(e,t,r,a,n,i){function s(){return t.debug("Called search with search term: "+e.searchTerm),0==e.searchTerm.trim().length?void t.debug("Cannot search without search term."):(e.query.text=e.searchTerm,e.query.page=1,e.query.total=0,void a.searchArtistOrAlbum(e.searchTerm,0).then(function(t){var r=t.albums.items.concat(t.artists.items);e.items=l(r),e.query.total=t.albums.total>t.artists.total?t.albums.total:t.artists.total,e.isMoreAvailable=o(),e.noResults=!(r.length>0)})["catch"](function(r){t.error("Error in search: "+JSON.stringify(r)),e.items=[]}))}function c(){e.searchTerm=e.query.text;var t=n*e.query.page;a.searchArtistOrAlbum(e.searchTerm,t).then(function(t){var r=t.albums.items.concat(t.artists.items),a=l(r);Array.prototype.push.apply(e.items,a),e.query.page++,e.isMoreAvailable=o()})["catch"](function(e){console.log("Error!")})}function o(){return e.query.total>e.query.page*n}function l(e){return e.map(function(e,t){return 0===e.images.length&&(e.images=[{url:"images/no-image.png"}]),e})}function u(t){e.selectedItem=t}e.searchTerm="",e.search=s,e.selectItem=u,e.query={text:null,page:0,total:0},e.loadMore=c,e.isMoreAvailable=!1,e.items=[],e.noResults=!1,e.canLoadMore=o}]);